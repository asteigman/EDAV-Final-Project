---
title: "Final Project: Exploring the National Survey on Drug Use and Health "
author: "Suman Tripathy, Amanda Steigman"
date: "11/23/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(vcd)
library(tidyverse)
library(forcats)
library(gridExtra)
library(gridGraphics)
library(scales)
library(ggmosaic)
library(mi)
library(dplyr)
library(plyr)
```

## I. Introduction

The opioid crisis in America has been worsening rapidly and is perhaps finally gaining the public and media awareness it needs. Opioids are most commonly prescription pain relievers, but the category also stretches to include heroin and synthetic opioids such as fentanyl. The topic is both concerning and fascinating, as the opioids used most frequently are ones that can be prescribed by doctors, such as oxycodone and hydrocodone. Some users may then transition to other drugs or illegal opioids like heroin. 

Opioid usage is getting more and more common. The National Institute on Drug Abuse found in January 2019 that "more than 130 people in the United States die after overdosing on opioids" every day. The Center for Disease Control and Prevention has released an estimate that opioid misuse in the US costs $78.5 billion a year in terms of healthcare costs, lost productivity, rehab treatments, and criminal justice activities.

The NSDUH 2013 survey asks questions about nonmedical use of drugs, "which it defined as when a prescription opioid was used when not presribed to the user or used for the experience or feeling caused by the drug." This term "nonmedical use" has inherent ambiguity, and recent studies of the NSDUH data estimate that about two-thirds of adults miusing opioids actually used the drug in order to relieve physical pain. Other adults used the medication to relieve stress or anxiety and sleep. Only about 11% of misusers are thought to actually use the opioid to "get high."  These figures are important to remember throughout our analysis of opioid users in order for us to understand the opioid crisis more precisely.

Our project explores non-medical opioid use, a term which has inherent ambiguity. In our analysis, we stick to our data source's definition - when a prescribed opioid is taken but is either not prescribed to the user or is used for the "experience" of the drug. We take all our exploration and analysis with a grain of salt because survey takers may have been unclear about this definition  when answering the questions and moreover, there are unclear boundaries between non-medical use, misuse, and abuse. Non-medical use can therefore be for a variety of reasons: self-medication, anxiety or depression relief, insomnia, chronic pain management, or simply to get "high." Recent studies of the survey data we use estimate that about two-thirds of adults misusing opioids are actually using the drug in order to relieve physical pain. Other adults used the medication to relieve stress or anxiety and sleep. Only about 11% of misusers are thought to actually use the opioid to "get high." It is important to recognize these shortcomings about the data so as to qualify all conclusions we derive and understand the opioid crisis as precisely as possible. 

Sources ofprescription painkillers can be either the "black market" off the street or directly from doctors. An alarming number of doctors have been caught for inappropriate opioid prescription. Moreover, 21% to 29% of chronic pain patients have been found to misuse their prescribed opioids. 8% to 12% may develop an opioid use disorder, and 4% to 6% transition from an opioid prescripton to heroin use. Given these worrisome figures, which provide part of the basis for *how* people are using opioids, we chose to explore data regarding *who* is misusing opioids in the United States. We focused on answering the following questions:

  - What are the interesting trends and rates of opioid abuse across different income groups?
  - Is there are strong relationship between opioid abuse and crime? What interesting depth can income add to this relationship?
  - The cause of a lot of opioid misuse is physical illness, but what are the ties to mental illness?
  - What particular difficulties do youth who abuse opioids face? 
  - What trends do we see between opioid abuse and other substance abuse? 

## II. Data Sources

Our data source is the [National Survey on Drug Use and Health](https://www.icpsr.umich.edu/icpsrweb/NAHDAP/studies/35509/documentation#) from 2013. The primary investigators were the United States Department of Health and Human Services, the Substance Abuse and Mental Health Services Administration, and the Center for Behavioral Health Statistics and Quality. This survey has been conducted perioidically since 1971 and has transitioned from a traditional paper-pencil method to a computer-assisted interviewing method. It combines computer-assisted personal interviewing and computer-assisted self-interviewing. It is a highly private and confidential system in order to encourage participant honesty regarding these sensitive behaviors.

The demographic population is "the civilian, noninstituitionalized population of the United States ... who were 12 years of age or older at the time of the survey." Since 2002, NSDUH respondents have been incentivized with a $30 reward for taking the survey, and an improvement in the survey response rate was noted afterwards. This increase in response rate may also be tied to better public awareness about these critical issues. A total final sample of 67,838 interviews were conducted.

The dataset itself contains a myriad of information about the use of drugs, alcohol, and tobacco. It also covers mental and physical illnesses, population demographics, criminal activities, and more. The target demographic is members of US households, age 12 and older. Our loaded dataframe contains 55160 rows (participants) and 3142 columns (survey questions). Note that some of these columns are imputed values based on responses to other survey questions. Moreover, there is likely a discrepancy between the dataset's rows and total number of interviews due to quality checks for misinformation or missing data. 

As we are working with survey data, we will make sure to be aware of all the possible challenges that may come with this (for example, making sure that "missing" values are actually "missing" and are not logically "no.") We are checking this by going back to earlier survey sections to see how participants' earlier responses may have caused parts of the survey to be skipped. We are also evaluating the imputed columns to see whether they are more cleaned and reliable than direct response columns.

## III. Data Transformation

We imported our data as a .rda file, which added a new challenge because loading and accessing the data was different than with the previous file types we have worked with. It was not extremely difficult though, and once the data was loaded in, we could deal with it as a typical data.frame object.  We proceeded to do all our cleaning on this data in the cleaning script and saved the cleaned data to a csv file, which we will now import here.

```{r}
# Read in data that has been cleaned with our cleaning script
drug_study <- read.csv(file="cleaned_drug_study.csv", header=TRUE, sep=",") 

# People who have taken opioids non-medically
opioid_users <- drug_study[drug_study$Opioid=="yes",]

# People who have never taken opioids non-medically
non_users <- drug_study[drug_study$Opioid=="no",]

# Responses from youth under 17 in the drug study
drug_study_youth <- drug_study[drug_study$Age=="12-13" | drug_study$Age=="14-15" | drug_study$Age=="16-17",]
drug_study_youth_plot <- select(drug_study_youth,Opioid,Marijuana,Stimulant)

# Add in some more basic mutations and cleaning 
opioid_users <- opioid_users %>% mutate(
  frequency = case_when(
    opioid_users$ANLYRTOT < 100 ~ 'infrequent',
    opioid_users$ANLYRTOT >= 200 ~ 'highly frequent',
    opioid_users$ANLYRTOT >= 100 & opioid_users$ANLYRTOT < 200 ~ 'frequent'),
    TRUE ~ NA)
opioid_users$frequency <- factor(opioid_users$frequency, levels = c("infrequent", "frequent", "highly frequent"))
opioid_users$Income <- as.factor(opioid_users$Income)
opioid_users$Income <- fct_relevel(opioid_users$Income,">$75,000",after=3)
drug_study$Income <- as.factor(drug_study$Income)
drug_study$Income <- fct_relevel(drug_study$Income,">$75,000",after=3)
non_users$Income <- as.factor(non_users$Income)
non_users$Income <- fct_relevel(non_users$Income,">$75,000",after=3)
```

## IV. Missing Values

A significant part of data analysis and visualization that is typically glossed over or considered boring is examining and imputing missing values in a dataset. Null values require close attention because for some variables, they may represent 0 or "no" or some base case type of response, and in other cases, they may simply be unanswered or non-inputted values. Sometimes, they can be imputed with column averages, logical extensions of other columns, or careful guesswork and estimation. Other times, however, the missing values must be dropped or simply ignored because there is no logical way to derive them. Here, we explore some patterns of missingness we see within our subset of opioid users.

```{r, warning=FALSE, message=FALSE}
x <- missing_data.frame(opioid_users)
image(x)
# x@patterns
```


Of all the columns we're interested in exploring, we see the most missing values in the various areas of youth participation such as community, faith, and school (around 84% missing in each category). It's important to note that this dataset has the raw survey variables YESCHACT, YEOTHACT, etc. that we clean and rename to be School, Community, etc., which is why we see those two identical black rectangles in our graph. Same for the variable ANYLRTOT and its cleaned counterpart - frequency. When we look at the patterns of missingness, we see that these youth variables tend to either all have values or all be missing concurrently for one row. The most likely cause for these rows is that the respondent is an adult and therefore does not need to answer these youth-specific questions.

We see that about 63.8% of ANLYRTOT / frequency (the count of how many times a respondent took opioids this year) are missing, so we must be aware of this whenever we want to look at how frequently users consume opioids. Lastly, we have only about 200 missing values (2.5%) for various illnesses such as depression and anxiety and 19 missing values (0.2%) for whether a respondent has been arrested, both of which are relatively small proportions of nulls that we can simply remove from the dataset if needed. We also see that some rows have missing values for both anxiety and depression, so again, perhaps if people mark that they have no mental health condition, they skip all questions about specific illnesses and thereby create missing values for these variables.

```{r}
# devtools::install_github("CRAN/extracat")
# extracat::visna(opioid_users)
```

## V. Results

### Prescription Painkiller Use and Income

We define a "user" as someone who has used any sort of prescription painkiller non-medically at least once in their lives. Just under 15% of respondents are opioid users.

```{r}
nrow(opioid_users)/nrow(drug_study)*100
```

Now, we consider respondents' incomes within our sample. Looking at all of our respondents, about 30% of users make <$20,000 per year, 35% between $20,000 and $49,999, 15% between $50,000 and $74,999, and 20% above $75,000 per year. We wanted to add another dimension to this and get more insight on whether certain combinations of groups, also considering gender, were using prescription painkillers. To see how our drug users vary with regard to income and sex, we created the plot below. This plot only includes opioid users, making it easy to see the breakdown. 

```{r}
colorblind_palette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

ggplot(data = opioid_users) +
   geom_mosaic(aes(x = product(Income, Sex), fill=Income), na.rm=TRUE, show.legend = FALSE) +
   labs(x="Sex", y="Income", title='Sex and Income of Opioid Users')  +
  theme_grey(14) +
  scale_fill_manual(values=c("#56B4E9",  "#CC79A7", "#009E73", "#D55E00"))
```

Above, we can see that nearly identical proportions of females and males have used prescription painkillers non-medically (slightly more males than females). However, we do see some differences of use within gender when we vary income level. For both genders, we see that the highest proportion of users has an income of between $20,000 and $49,000. For females, usage drops off a bit after that (the majority of female users tend to be more poor). On the other hand, our male respondents with the highest income made up a larger portion of male users as compared to the female proportions. However, for both groups the smallest proportion of opioid users are in the income bracket of $50,000 - $74,999, which is somewhat of an anomaly since it seems more reasonable that either the richest or poorest income groups would be abusing opioids the most, either due to more life struggles or due to more money to spend.  
#is this last sentence problematic to write?? lol it's just my opinion

The above graph only considers whether a respondent has used a prescription painkiler non-medically before, but to dig into the data more, we chose to look at the frequency of use, this time focusing only on income. Looking at the frequency can give us a better idea of whether a respondent was abusing an opioid recreationally or whether a user may have been taking the drug for a prolonged period of time for a reason they viewed as necessary, like chronic pain.  
# CLARIFY RECREATIONAL VS PROLONGED ETC

```{r, warning=FALSE, fig.height=4, fig.width=10}
ggplot(data = opioid_users, mapping = aes(ANLYRTOT)) + 
  geom_histogram(binwidth = 10, boundary=-0.5, fill="#0072B2") + 
  labs(title = "Total Days Using Non-Medical Pain Reliever in Past Year", x = "Number of Days", y = "Count") + 
  scale_x_continuous(breaks=seq(0,365,10))  +
  theme_grey(11) 
  # TO MAKE TEXT BIGGER AND MAKE AXIS TICKS EVERY 20 OR MORE SENSICAL THIS WAY?
```

This variable ANYLRTOT records how mamny times in the past year a respondent used opioids. However, as mentioned in the missing data section, the majority of values were missing (63.8%). This could be attributed to various reasons -  people using opioids non-medically frequently may have felt uncomfortable answering the question, people may have done it rarely or never and thought not answering the question would equate to 0 days, or people may simply have not remembered how many days they used opioids. Nonetheless, we still explore the data points we do have. The histogram above is unimodal showing that most opioid misusers have taken the opioid less than ten times a year. To be consistent with many previous opioid investigations, we define frequent users as those with 100 or more days of nonmedical opioid use in the past year and highly frequent as those with 200 or more days of nonmedical use. If we only look at the opioid users who answered this question on the survey, 7.24% (212 out of 2927) of them can be classified as highly frequent users, 9.5% (279 out of 2927) are frequent users, and 83.2% (2436 out of 2927) report infrequent use.  

```{r, fig.width=10}
ggplot(opioid_users[!is.na(opioid_users$frequency),], aes(fct_rev(Income))) + 
  geom_bar(aes(fill=fct_rev(frequency)), position="fill") + 
  labs(title="Opioid Use Frequency Based on Income",
        x="Income Bracket",
        y="Proportion",
        fill='Frequency of Use') + 
  guides(fill = guide_legend(reverse = TRUE)) +
  coord_flip()  +
  theme_grey(14) +
  scale_fill_manual(values=c("#F0E442", "#56B4E9", "#D55E00"))
```
It is important to note that in the above graph, we only look at the subset of opioid users who recorded their frequency of opioid use. Across all income groups, we see relatively similar ratios. The greatest proportions of frequent and highly frequent users is in the income bracket of under $20,000 per year. The second highest percentages are in the income group of between $20,000 and $49,999 anually. Overall though, the breakdown does not deviate much from the frequency of use not accounting for income. This is interesting because it provides evidence for the argument that income may not be a barrier to getting the drug for recreational (frequent or highly frequent, versus infrequent which is less likely to be, but still can be, recreational) use.  
# I THINK SOMEWHERE ABOVE WE IMPLY THAT INFREQUENT USE IS MORE LIKELY TO BE RECREATIONAL THAN FREQ / HIGHLY FREQ USE? THIS CONTRACTS THAT ? CHECK CHECK CHECK

While it is difficult to determine the actual price of purchasing prescription painkillers due to the fact that they are often obtained on the "black market," we used StreetRx, a program that allows people to anonymously submit how much they paid for illegal drugs, as an estimate. According to [StreetRx](https://streetrx.com/), the average price per milligram of oxycodone, one of the most commonly used prescription painkillers, is $1.40. Based on this, a user would pay around $15 per pill/dose. For a frequent user - which is what the majority of our sample can be classified as - this would mean he spends, on average, between $1,500 and $3,000 per year on prescription painkillers. This is not cheap - especially for someone making $20,000 per year, this could mean 7.5% to 15% of income would be going to drug use. Thus, it is interesting to see that the greatest proportions of frequent and highly frequent users are in the income bracket of under $20,000 and that evidently, income is not a major barrier to opioid abuse and addiction.

Lastly, we look at the relationship between income and crime, specifically comparing arrest rates of non-medical opioid users to non-users. 

```{r, warning=FALSE, fig.height=6,fig.width=12}
levels(opioid_users$Income) <- gsub("- ", "-\n", levels(opioid_users$Income))
levels(non_users$Income) <- gsub("- ", "-\n", levels(non_users$Income))

users_plot <- ggplot(opioid_users[!is.na(opioid_users$Booked),]) +
  aes(x = Income, fill = Booked) +
  labs(fill = "Arrested", y = "Proportion of Arrests",x="Income",title="Proportion of Arrests by Income for Opioid Users") +
  geom_bar(position = "fill", show.legend = FALSE) + 
  theme(plot.title = element_text(hjust = 0.5)) +
  theme_grey(13) + 
  scale_fill_manual(values=c("#E69F00", "#56B4E9"))

nonusers_plot <- ggplot(non_users[!is.na(non_users$Booked),]) +
  aes(x = Income, fill = Booked) +
  labs(fill = "Arrested",x="Income",y="",title="Proportion of Arrests by Income for Non-Users") +
  geom_bar(position = "fill") + 
  theme(plot.title = element_text(hjust = 0.5))  +
  theme_grey(13) + 
  scale_fill_manual(values=c("#E69F00", "#56B4E9"))

grid.arrange(users_plot, nonusers_plot, ncol=2)
```

Overall, just about one third of opioid users have been arrested and booked for a crime. Broken down by income bracket, we can see that as income increases, the proportion of users who have been arrested decreases. For the poorest group, 39.7% of users have been arrested, and for the wealthiest group, 27.4% of users have been arrested. For non-users, the story is different in some ways and similar in others - overall, the proportion of non-users who have been arrested is 11%, which is much lower than what we observed overall for users. We still see that as income increases, the proportion of non-users who have been arrested decreases. For the poorest group, 15% of users have been arrested, and for the wealthiest group, only 7.5% of users have been arrested. Crime proves to have an interesting relationship with opioid use, so we now explore it further by breaking down arrests across various opioid usage frequencies.

```{r, fig.width=10}
p = ggplot(data = opioid_users[!is.na(opioid_users$Booked) & !is.na(opioid_users$frequency),], mapping = aes(Booked)) + 
  geom_bar(aes(y = ..prop.., group = 1), fill = c("#E69F00", "#56B4E9", "#E69F00", "#56B4E9", "#E69F00", "#56B4E9")) + 
  facet_wrap(~frequency) +
  labs(title = "Ever Been Arrested and Booked for Breaking Law", x = "Been Booked", y = "Proportion") + 
  theme_grey(14) 
  
show(p)

# DOES THIS NEED A LEGEND? I JUST COLOR CODED TO BE AESTHETIC
```

Looking once more at the smaller subset of users who responded about their frequency of use, we see a positive correlation between frequency of use and arrest rate. Of all the infrequent users, only about 30% have ever been booked. For frequent users, this figure increases to about 46%. Highly frequent users hold the highest percentage, with nearly 50% of them have been booked before. This finding is interesting because opioids do seem like a more "harmless" or "peaceful" type of drug to abuse. We must recognize, however, that there may other serious issues in these respondents' lives that can lead to both increased opioid abuse as well as higher likelihoods of committing crimes. One such potential cause is mental health, which we chose to investigate in depth in the following section.

### Mental Health's Relationship to Opioid Abuse

A great deal of opioid abusers claim that they use opioids to self-medicate - for chronic pain, anxiety, depression, insomnia, or another condition. Fortunately, the NSDUH survey includes questions about various health conditions that we can explore in relation to opioid use. A lot of the data is for specific illnesses such as Tuberculosis and Asthma, which don't have strong ties to painkiller misuse, so instead we specifically look at two mental health categories that may be more tied to opioids - anxiety and depression.

```{r, warning=FALSE, fig.width=10}
opioid_users$Anxiety <- factor(opioid_users$Anxiety, levels = c("no", "yes"))

p1 <- ggplot(non_users[!is.na(non_users$Anxiety),], mapping = aes(Anxiety)) +
  geom_bar(aes(y = ..prop.., group = 1), fill = c("#E69F00", "#56B4E9")) +
  labs(title = "Non-Opioid Users' Anxiety Rates", x = "Has Anxiety", y = "Proportion") + 
  theme_grey(14) 

p2 <- ggplot(opioid_users[!is.na(opioid_users$Anxiety),], mapping = aes(Anxiety)) +
  geom_bar(aes(y = ..prop.., group = 1), fill = c("#E69F00", "#56B4E9")) +
  labs(title = "Opioid Users' Anxiety Rates", x = "Has Anxiety", y = "Proportion") + 
  theme_grey(14) 

p3 <- ggplot(non_users[!is.na(non_users$Depression),], mapping = aes(Depression)) +
  geom_bar(aes(y = ..prop.., group = 1), fill = c("#E69F00", "#56B4E9")) +
  labs(title = "Non-Opioid Users' Depression Rates", x = "Has Depression", y = "") + 
  theme_grey(14) 

p4 <- ggplot(opioid_users[!is.na(opioid_users$Depression),], mapping = aes(Depression)) +
  geom_bar(aes(y = ..prop.., group = 1), fill = c("#E69F00", "#56B4E9")) +
  labs(title = "Opioid Users' Depression Rates", x = "Has Depression", y = "") + 
  theme_grey(14) 

grid.arrange(p1, p2, p3, p4, nrow=2, ncol=2)

# DOES THIS NEED A LEGEND? I JUST COLOR CODED TO BE PRETTY
```

Here, we compare anxiety levels across opioid users and non-opioid users.  Firstly, we note that the percentages in each graph do not add up to 100% due to NA responses. More interestingly, however, we see a substantial difference between opioid users' and non-opioid users' anxiety rates. Only about 5.06% of non-opioid users report having anxiety whereas 13.40% of opioid users report anxiety. We see extremely similar results when comparing depression rates between non-users and users as well. 5.82% of non-users indicated that they had depression as compared to the 13.45% of opioid users with depression.  

To see how significant these results actually are, we conduct a [Chi-Square Test of Independence](https://www.statisticssolutions.com/non-parametric-analysis-chi-square/. This test serves to determine whether there is a statistically significant relationship between two categorical variables (i.e. anxiety and opioid use, depression and opioid use). The basis of the test rests on an initial hypothesis that there is no relationship between these variables, and we only "reject" this hypothesis, meaning assume there is some relationship between the variables, if we find an extremely low probability of observing the data we have. We set a "level of significance," which is a boundary for how rare the results that we see must be in order for us to believe our initial hypothesis must be incorrect.

```{r}
chisq.test(drug_study$Opioid,drug_study$Anxiety)
chisq.test(drug_study$Opioid,drug_study$Depression)
```

When we conduct the Chi-Square Test of Independence on our variables, we see extremely small p-values, implying that there is an incredibly low probability of seeing these survey responses when opioid use is completely independent to both anxiety and depression. Therefore, even when we choose an extremely low significance level of 1%, we still "reject" our initial hypothesis, implying that there is a correlation between opioid use and anxiety as well as a correlation between opioid use and depression.

To continue gaining insights about what kind of opioid users face these mental health issues that may be tied to their painkiller misuse, we explore some extra factors like gender, age, and frequency of use. We initially looked at gender, but the results were not particularly surprising. We saw very clearly that women's anxiety and depression rates are almost double that of men, regardless of whether they use opioid. This is a well-researched phenomenon. For example, the Anxiety and Depression Association of America has released numerous studies and [articles](https://adaa.org/about-adaa/press-room/facts-statistics) stating that women are twice as likely to have anxiety as men, and the most common disorder to co-occur with anxiety is depression. 

Therefore, we instead display mosaic plots that break down anxiety and depression rates across opioid users based on frequency of use and age.

```{r, fig.width=11, fig.height=4}
opioid_users$Anxiety <- factor(opioid_users$Anxiety, levels = c("yes", "no"))
opioid_users$Depression <- factor(opioid_users$Depression, levels = c("yes", "no"))
levels(opioid_users$frequency) <- gsub(" ", "\n", levels(opioid_users$frequency))

p1 <-  ggplot(data = opioid_users[!is.na(opioid_users$frequency),]) +
   geom_mosaic(aes(x = product(Anxiety, frequency), fill=Anxiety), na.rm=TRUE, show.legend = FALSE) +
   labs(x="Frequency of Opioid Use", y="Has Anxiety", title='Frequency of Use Breakdown for Opioid Users with Anxiety') +
   theme_grey(11) + 
  scale_fill_manual(values=c("#E69F00", "#56B4E9"))

p2 <-  ggplot(data = opioid_users[!is.na(opioid_users$frequency),]) +
   geom_mosaic(aes(x = product(Depression, frequency), fill=Depression), na.rm=TRUE, show.legend = FALSE) +
   labs(x="Frequency of Opioid Use", y="Has Depression", title='Frequency of Use Breakdown for Opioid Users with Depression') + 
   theme_grey(11) + 
  scale_fill_manual(values=c("#E69F00", "#56B4E9"))

grid.arrange(p1, p2, ncol=2)
```

We note that anxiety and depression rates increase alongside frequency of opioid use. Infrequent opioid users have the lowest rates of anxiety (15.7%)  and depression (15.5%) whereas highly frequent opioid users are the most likely to have anxiety (21.7%) and depression (22.7%). There could be a variety of reasons for this finding. The most naive assumption is that anxious or depressed people may take opioids regularly to "cope" with these disorders. More likely, however, is a hidden underlying variable such as chronic illness that may be correlated with anxiety and depression as well as highly frequent opioid use. The [Harvard Women's Health Watch](https://www.health.harvard.edu/staying-healthy/anxiety_and_physical_illness) finds that people with chronic respiratory disorders have a higher likelihood of developing anxiety disorders and vice versa as well. Worryingly, they also assert that "anxiety is a cause for non-compliance with medical treatment." This could either mean not regularly keeping up with medications and self-care or more relevant to our analysis, abusing prescribed painkiller medications. Unfortunately, the NSDUH data does not provide very much data on chronic conditions, so these interesting questions could only be further researched with an adjacent data set. 

We see extremely similar trends in anxiety and depression so far, so in our next graph, we focus specifically on anxiety in order to remove redundant results.

```{r, fig.width=10, fig.height=4}
opioid_users$Anxiety <- factor(opioid_users$Anxiety, levels = c("yes", "no"))

a1 <-  ggplot(data = opioid_users) +
   geom_mosaic(aes(x = product(Anxiety, Age), fill=Anxiety), na.rm=TRUE, show.legend = FALSE) +
   labs(x="Age", y="Has Anxiety", title='Age Breakdown of Opioid Users with Anxiety') +
   theme_grey(13) + 
   scale_fill_manual(values=c("#E69F00", "#56B4E9"))
show(a1)
```
Now, we investigate anxiety rates in opioid users broken down by age groups. We looked at a plot of anxiety rates in non users split by age as well, but it provided nearly the same insights as this graph, so we elected not to include it. The graph clearly displays a general trend of increasing likelihood of anxiety with age, meaning the youngest opioid users have the lowest proportion of anxiety while the oldest opioid users have the highest. The Anxiety and Depression Associate of America reaffirms these results by providing statistics that one in eight (12.5%) [children](https://adaa.org/living-with-anxiety/children) are affected by anxiety disorders where as 18.1% of the [adult](https://adaa.org/about-adaa/press-room/facts-statistics) population in the US are prone to anxiety disorders. This leads to the takeaway that youth opioid misuse is perhaps less tied to anxiety and depression than adult misuse. As a result, there must be different causes for youth misuse such as social environment, extracurriculars, peer pressure, and more, which we now go on to explore in the next section.

### Youth Prescription Painkiller Use

Now, we move on to our questions about painkiller use within youths. First, we look generally at opioid users segregated into various age groups to see how youth consumption rates compare to adult rates. Above the age of 35 years old, we cannot differentiate between respondents due to the age brackets set by the survey, but we have granular information for younger ages, which is conveniently the demographic we are most interested in. 

```{r}
ggplot(drug_study, aes(fct_rev(Age))) + 
  geom_bar(aes(fill=Opioid), position="fill") + 
  labs(title="Opioid Use Based on Age",
        x="Age Group",
        y="Proportion",
        fill='Used Opioid') +
  coord_flip() + 
  theme(plot.title = element_text(hjust = 0.5)) + 
  theme_grey(14) + 
  guides(fill = guide_legend(reverse = TRUE)) + 
  scale_fill_manual(values=c("#E69F00", "#56B4E9"))
```

We can see that as age increases, a user is more likely to have used a prescription painkiller non-medically, but this levels off at the ages of 21-34 and even decreases for the oldest group. It is obvious and intuitive that there would be a larger proportion of people who have tried opioids as age increases because they have had longer to try these drugs, and it is more rare to try a "harder" drug (substances like opioids and stimulants as opposed to marijuana and alcohol) at a younger age. What is more interesting, though for this chart, is the older demographic: if an individual has not tried taking a prescription painkiller non-medically by their early 20's, they are perhaps less likely to ever try them as they get older. Additionally, the fact that the oldest population is the least likely to have used opioids non-medically suggets that opioid misuse has become a more popular issue in the United States. It implies that perhaps there is some level of youth "hype" over the drug that leads to higher use in these age groups. 

For our youth population as a whole (N = 17,736; ages 12-17), approximately 7.6% of respondents have tried an opioid for non-medical purposes, which is about half of the rate we found overall in the survey. We proceed by examining how this group of users may differ from their peers. First, we look at the different types of activities that youth respondents participated in. Participation in activities is interesting to look at because it can give us insight to how engaged a youth is - we would expect youths who are more engaged to be less likely to use opioids (and other drugs) non-medically.

```{r, fig.width=9}
tidy_act <- select(.data=drug_study,Faith,School,Community,Other,Opioid) %>%
    gather(key="Activity",value="Participated",-Opioid)
tidy_act_yth <- na.omit(tidy_act)
tidy_act_yth$Participated <- as.factor(tidy_act_yth$Participated)
tidy_act_yth$Activity <- as.factor(tidy_act_yth$Activity)

ggplot(tidy_act_yth, aes(Opioid)) + 
  geom_bar(aes(fill=Participated), position="fill") + 
  facet_wrap(~fct_relevel(Activity,"Other", after=3)) +
  labs(title="Youth Participation in Different Activities for Opioid Users vs. Non-Users",
        x="Used Opioid Non-Medically",
        y="Proportion",
        fill='Participated') +
  theme(plot.title = element_text(hjust = 0.5)) + 
  theme_grey(14) + 
  scale_fill_manual(values=c("#E69F00", "#56B4E9"))

```

We can see that overall, there is not much difference between participation in each activity based on opioid usage - while those youth who have never tried an opioid non-medically have slightly higher participation, it is never by more than 5%. Regardless of opioid usage, the highest proportion of youth participates in activities at school, then community activities, followed by faith-based activities, and finally other activities. The overall lack of difference between opioid users and non-users in participation rates goes against what we would expect, which leads us to ask: if being more engaged is not a way to prevent opioid usage in teens, what is?

Opioids are relatively inaccessible and are considered to be "hard" drugs (more risk of addiction and more serious negative health impacts) when compared to, for example, marijuana, which is used more commonly both among adults and teens. If a teen is experimenting with prescription painkillers, we may expect that he or she would also be experimenting with other drugs (we cannot infer anything about causality based on our data, but we can look at the correlations). We test whether there is a relationship between a youth having used a prescription painkiller non-medically and a youth having used marijuana (a less "hard" drug) as well as whether there is a relationship between a youth having used a prescription painkiller and a youth having used stimulants such as amphetamine (another "hard" drug).

```{r}

#marijuana
# mosaic(Opioid ~ Marijuana,
#        data = drug_study_youth_plot, 
#        direction = c("v", "h"),
#        gp = grid::gpar(fill=c('light green', 'dark green')),
#        main = "Marijuana Use and Prescription Painkiller Use")

#chisq.test(drug_study_youth_plot$Painkiller,drug_study_youth_plot$Marijuana)

# I WONDER IF WE CAN MAKE ONE OF THOSE PLOTS THAT COMPARE VARIABLES HERE?  LIKE THE MANY SQUARES ONE?
```

Among youth, 17.6% of respondents reported having used marijuana at least once (a little more than double the proportion of youth who reported having tried prescription painkillers non-medically at least once). The plot above suggests that there is a relationship between teens using marijuana and using prescription opioids, and the Chi-squared test of independence also provided evidence towards this result (p-value of < .01). As we can see, the vast majority - almost four-fifths of youth - have not tried either drug. However, among youth that have tried marijuana, almost 23% have tried using a prescription painkiller non-medically. This is three times the proportion of youth who have tried one of these types of drugs in our general youth survey sample. Interestingly, though, 4.3% of our youth sample tried prescription painkillers without trying marijuana. While this is only a little more than half the rate for youth overall, it is still a bit higher than we would expect. Perhaps the drug was more accessible to these youth because they stole it from their parents or had extra left from a surgery or an injury versus marijuana which they would need to purchase from someone. It is also more difficult to hide marijuana from parents than it is to hide pills.

```{r}
#stimulants
# mosaic(Opioid ~ Stimulant,
#        data = drug_study_youth_plot, 
#        direction = c("v", "h"),
#        gp = grid::gpar(fill=c('pink','dark red')),
#        main = "Stimulant Use and Prescription Painkiller Use")

#chisq.test(drug_study_youth_plot$Painkiller,drug_study_youth_plot$Stimulant)
```

Among youth, only around 2% have reported trying a stimulant at least once. The plot above suggests that there is a relationship between teens using stimulants and using prescription opioids, and the Chi-squared test of independence also provided evidence towards this result (p-value of < .01). Again, most teens - almost 92% - have not tried either drug. Teens who have tried stimulants are extremely more likely to have tried a prescription painkiller non-medically; this is the case for almost 3/5 of teens who have tried stimulants. Having tried a prescription painkiller is not as strong of a predictor of having tried a stimulant - this is the case for about 14.5% of those who have tried opioids (about double the rate for youth overall). Overall, it is interesting that there is a relationship between using the two drugs since they have quite different effects on the user. However, this suggests that teens using both drugs are perhaps more interested in chasing the "high" regardless of what it is specifically and are possibly more interested in experimenting with drugs more generally.


## VI. Interactive Component

## VII. Conclusion

The NSDUH dataset turned out to be an extremely useful data source with many variables that have interesting connections to opioid use. We explored a lot of basic demographics of opioid users and derived some intriguing statistics - about 50% of users are male and 50% female. The most common income bracket for opioid users is $20,000 to $49,999, and the most common ages of opioid users are 21 to 34. We also saw a correlation between opioid users and a higher number of arrests, specifically as we leaned towards poorer income brackets.

We then went on to do more complex analysis by comparing variables across different frequencies of opioid use. To be consistent with many previous opioid investigations, we defined frequent users as those with 100 or more days of nonmedical opioid use in the past year and highly frequent users as those with 200 or more days of nonmedical use. We saw positive correlations between increased frequency of opioid use and increased arrest rate as well as increased frequency of opioid use and increased anxiety / depression.

Lastly, we scrutinized youth opioid users and potential reasons for their abuse. We unfortunately did not see any clear relationship between youth participation in activities and opioid use, so we instead decided to explore whether opioid use is tied to other drugs as well. This inspired our interactive component in which we allow our audience to personally examine opioids' relationship with other drugs, within both youth and adult users. 

Depsite finding many captivating patterns in the dataset, we still recognize a major limitation with the survey data is how accurately it captures opioid misuse, most notably with the term "misuse" itself. In the American Journal of Drug and Alcohol Abuse, Joseph Palamar wrote an [article](https://www.tandfonline.com/doi/full/10.1080/00952990.2018.1521826) on this specific subject that helped deepen our subject knowledge and awareness. It targets various problems with the survey such as terminology, definition, and the lacking granularity of the term "opioid." Our greatest takeaway is that opioid misuse can never be studied accurately and that we must be okay with indefinite analysis, but improving question terminology and specifity on these surveys can at least help our investigation.

Another shortcoming we noted about our project was that we only have cross-sectional data as opposed to longitudinal data. We have information about users at this very specific moment in time (2013), but this survey has little to no clarity about past patterns and future patterns. Nonetheless, the NSDUH survey has been conducted numerous times between 1979 and 2014. Therefore, there is potential to build some kind of longitudinal analysis of how opioid use rates and patterns have changed over time.  Unfortunately, however, individual users cannot be tracked over time, so it's hard to see how people change or how different variables can affect use rates at different times. 

As we worked on our own project, we found many relevant and interconnected articles. Considering how pop culture and "hype" could be factors in youth opioid use, we were particularly interested in this [analysis](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6371364/) of opioid use in relation to social media. We were also shocked by the figure stated in the introduction of $78.5 billion a year being spent on opioid use, so this drugabuse.gov [page](https://www.drugabuse.gov/publications/research-reports/medications-to-treat-opioid-addiction/how-much-does-opioid-treatment-cost) proved riveting.

We still have many lingering questions and insights we would like to obtain regarding opioid use. For example, what are the most common sources of obtaining opioids if not from a medical prescription? What factors contribute most to whether an individual uses a prescription painkiller non-medically? How do we define boundaries between use, misuse, abuse, and addiction? Opioid use is a truly infinite and multi-faceted topic that can be researched in great depth. We have barely broken the ice on the endless research that can be done, and we now feel particularly motivated to stay up-to-date with the opioid epidemic and continue our investigation whenever possible.